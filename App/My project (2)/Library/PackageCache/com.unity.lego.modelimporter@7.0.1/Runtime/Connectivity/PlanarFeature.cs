// Copyright (C) LEGO System A/S - All Rights Reserved
// Unauthorized copying of this file, via any medium is strictly prohibited

using System;
using System.Collections.Generic;
using UnityEngine;

namespace LEGOModelImporter
{
    [Serializable]
    public class PlanarFeature : Connection
    {
        public enum PlanarConnectionType
        {
            knob = 0,
            hollowKnob,
            knobFitInPegHole,           // Function similar to knob, plus fits in pegHole
            hollowKnobFitInPegHole,     // Function similar to hollowKnob, plus fits in pegHole
            squareKnob,                 // Fit only in square anti knob

            tube,                       // Connector on bottom of a round 1x1
            tubeWithRib,                // Function similar to tube, but has ribs sticking out to the sides rejecting tubeGrabber
            bottomTube,                 // Function similar to tube, but cannot connect to tubeGap or be occupied
            bottomTubeWithRib,          // Function similar to tubeWithRib, but cannot connect to tubeGap or be occupied

            secondaryPin,
            secondaryPinWithRib,
            secondaryPinWithTinyPinReceptor,
            secondaryPinWithRibAndTinyPinReceptor,

            fixedTube,                  // Tube that can not rotate, can only connect in the 4 90 degree orientations
            fixedTubeWithAntiKnob,      // Function similar to fixedTube, but knobs can also connect

            antiKnob,                   //
                                        //                       antiKnobWithSecondaryPin,   // Has a pin inside that Reject knobs but not hollow knobs

            pegHole,                    // anti knob at end of peg holes, only connects to special knobs

            squareAntiKnob,             // Function similar to anti knob, plus squareKnob fit in it

            tubeGap,                    // Receptor located diagonally between 4 knobs
            tubeGrabber,                // Wine glass that connect to tube, rejects tubes "WithRib"

            tinyPin,
            tinyPinReceptor,

            edge,                       // edge of any kind and rib
            edgeGap,

            knobReject,                 // Reject knobs, but not hollow knobs, does not connect to either

            powerFuncLeftTop,
            powerFuncRightTop,
            powerFuncLeftBottom,
            powerFuncRightBottom,

            voidFeature,

            duploKnob,

            duploHollowKnob,
            duploAntiKnob,
            duploTube,
            duploFixedTube,
            duploTubeGap,
            duploAnimalKnob,
            duploAnimalTube,

            secondaryPinReceptor,       // Function similar to hollowKnob, but cannot connect on the outside

            duploFixedAnimalTube,
            duploSecondaryPinWithRib,   // Connect to duploHollowKnob but Reject duploAnimalKnob
            duploSecondaryPin,          // Connect to both duploHollowKnob and duploAnimalKnob
            duploKnobReject,            // Reject duploKnob, but not duploHollowKnob nor duploAnimalKnob, does not connect to either of the latter
        }

        /// <summary>
        /// Every ConnectionPoint has some flags.
        /// </summary>
        public enum Flags
        {
            squareFeature = 1 << 0,                        // This feature is square (used for geometry optimization)
            roundFeature = 1 << 1,                         // This feature is round (used for geometry optimization)
            knobWithHole = 1 << 2,                         // Use hollow knob collision volumes ##################################### TODO: remove, using IsTechnicKnob() instead
            knobWithMiniFigHandHole = 1 << 3,              // Use mini-fig hand knob collision volumes
            knobWithSingleCollision = 1 << 4,              // Use single "hole" collision volume off to one side
            singleFeature = 1 << 5,                        // Feature is from a "single" sized field
            receptorDontRemoveKnobCollision = 1 << 6,      // When connecting don't remove the knob collision volume
            knobWithoutCollision = 1 << 7,                 // Knob should never have active collision volumes
        }    

        public static readonly Flags flagsCoveringKnob = Flags.squareFeature | Flags.roundFeature;
        public static readonly Flags flagsCoveringTube = Flags.squareFeature;

        public PlanarConnectionType connectionType;
        public int quadrants;
        public int index;
        public Flags flags;
        public Knob knob;
        public List<Tube> tubes;

        public PlanarField Field => field as PlanarField;

        ///<summary> 
        /// Connectivity interaction matrix
        /// Generated from connectivity matrix sheet: Connectivity Matrix.xls through python script .\load_connectivity_matrix.py.
        /// Last updated on: Wed Dec  9 11:33:41 2020
        ///</summary>
        private const int connectivityMatrixHeight = 43;
        private const int connectivityMatrixWidth = 43;

        private static readonly ConnectionInteraction[] connectivityMatrix = new ConnectionInteraction[connectivityMatrixWidth * connectivityMatrixHeight] {
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Fixed, ConnectionInteraction.Fixed, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Fixed, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Fixed, ConnectionInteraction.Hinge, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Hinge, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Ignore, ConnectionInteraction.Reject, ConnectionInteraction.Reject, ConnectionInteraction.Reject,
        };

        public static bool IsKnob(PlanarFeature connection)
        {
            switch (connection.connectionType)
            {
                case PlanarConnectionType.knob:
                case PlanarConnectionType.hollowKnob:
                case PlanarConnectionType.hollowKnobFitInPegHole:
                case PlanarConnectionType.knobFitInPegHole:
                    return true;
            }
            return false;
        }

        public void UpdateKnobsAndTubes()
        {            
            if (knob)
            {
                knob.UpdateVisibility();
                RegisterPrefabChanges(knob.gameObject);
            }

            foreach (var tube in tubes)
            {
                if (tube)
                {
                    tube.UpdateVisibility();
                    RegisterPrefabChanges(tube.gameObject);
                }
            }
        }

        public bool IsVisible()
        {
            var visible = false;
            if (knob)
            {
                visible = visible || knob.IsVisible();
            }

            foreach (var tube in tubes)
            {
                if (tube)
                {
                    visible = visible || tube.IsVisible();
                }
            }
            return visible;
        }

        public bool IsRelevantForTube()
        {
            // FIXME Temporary fix to tube removal while we work on connections that are related/non-rejecting but not connected.
            return connectionType == PlanarConnectionType.antiKnob || connectionType == PlanarConnectionType.squareAntiKnob;
        }

        /// <summary>
        /// Get the connection relationship between this and <paramref name="rhs"/>
        /// <param name="rhs">The connection we want to match with</param>
        /// </summary>
        /// <returns>Interaction between the features</returns>
        public override ConnectionInteraction MatchTypes(Connection rhs)
        {
            var i = (int)connectionType;
            var j = (int)(rhs as PlanarFeature).connectionType;
            var index = i + j * connectivityMatrixWidth;
            return connectivityMatrix[index];
        }

        /// <summary>
        /// Get the connection this connection is connected to
        /// </summary>
        /// <returns>Connection that the given connection is connected to</returns>
        public PlanarFeature GetConnection()
        {
            return Field.GetConnection(index);
        }        

        /// <summary>
        /// Check if a connection is connected to something
        /// </summary>
        /// <returns>Boolean saying whether or not this connection has a connection</returns>
        public bool HasConnection()
        {
            return Field.HasConnection(index);
        }

        /// <summary>
        /// Check whether a connection type can connect with anything
        /// </summary>
        /// <returns>Boolean determining whether it is a connectable type</returns>
        public bool IsConnectableType()
        {
            var startIndex = (int)connectionType;
            var endIndex = startIndex + connectivityMatrixWidth;
            for (var i = startIndex; i < endIndex; i++)
            {
                if (IsConnectable(connectivityMatrix[i]))
                {
                    return true;
                }
            }
            return false;
        }

        /// <summary>
        /// Find the offset this connection should have to give a visual 'click' animation
        /// </summary>
        /// <returns>The offset</returns>
        public Vector3 GetPreconnectOffset()
        {
            switch (connectionType)
            {
                case PlanarConnectionType.knob:
                case PlanarConnectionType.hollowKnob:
                case PlanarConnectionType.knobFitInPegHole:
                case PlanarConnectionType.hollowKnobFitInPegHole:
                case PlanarConnectionType.tubeGap:
                case PlanarConnectionType.edgeGap:
                    {
                        return field.transform.TransformDirection(Vector3.up * 0.1f);
                    }
                case PlanarConnectionType.tube:
                case PlanarConnectionType.antiKnob:
                case PlanarConnectionType.squareAntiKnob:
                case PlanarConnectionType.bottomTube:
                case PlanarConnectionType.bottomTubeWithRib:
                case PlanarConnectionType.fixedTubeWithAntiKnob:
                case PlanarConnectionType.edge:
                case PlanarConnectionType.secondaryPin:
                case PlanarConnectionType.pegHole:
                    {
                        return field.transform.TransformDirection(Vector3.down * 0.1f);
                    }
            }
            
            return Vector3.zero;
        }

        /// <summary>
        /// Get the position of this feature in world space
        /// </summary>
        /// <returns>Position in world space</returns>
        public Vector3 GetPosition()
        {
            return Field.GetPosition(this);
        }

        /// <summary>
        /// Check whether connecting to a feature would be valid
        /// </summary>
        /// <param name="rhs">The feature we are checking</param>
        /// <param name="match">The resulting interaction</param>
        /// <returns>Whether this connection would be valid at this transformation</returns>
        public bool CheckConnectionTransformationValid(PlanarFeature rhs, out ConnectionInteraction match)
        {
            if (rhs == null)
            {
                match = ConnectionInteraction.Reject;
                return false;
            }

            match = MatchTypes(rhs);
            if (match == ConnectionInteraction.Reject)
            {
                return false;
            }

            var POS_EPSILON = 0.01f;
            var ROT_EPSILON = 3.0f;

            var lhsPosition = GetPosition();
            var rhsPosition = rhs.GetPosition();
            return MathUtils.DistanceSquared(lhsPosition, rhsPosition) < POS_EPSILON && Vector3.Angle(field.transform.up, rhs.field.transform.up) < ROT_EPSILON;
        }        
    }
}
